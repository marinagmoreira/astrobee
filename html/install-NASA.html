<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: Install for NASA users</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.12.0</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robot operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('install-NASA.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Install for NASA users </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md114"></a>
Usage instructions for NASA users</h1>
<p>Install the 64-bit version of <a href="http://releases.ubuntu.com/16.04">Ubuntu16.04</a> on a host machine, and make sure that you can checkout and build code. If you are using a virtual machine, please use VMware. Virtualbox doesn't support some of our Gazebo plugins. </p><pre class="fragment">sudo apt-get install build-essential git
</pre><p> <em>Note: Please ensure you install the 64-bit version of Ubuntu. We do not support running Astrobee Robot Software on 32-bit systems.</em></p>
<h2><a class="anchor" id="autotoc_md115"></a>
Computer setup</h2>
<h3><a class="anchor" id="autotoc_md116"></a>
Username</h3>
<p>If you are using a VM with a username that does not match your NDC username, please configure the following variable: </p><pre class="fragment">export NDC_USERNAME=your_ndc_username
</pre><h3><a class="anchor" id="autotoc_md117"></a>
Access to the Astrobee Debian server</h3>
<p>The custom debian packages are currently distributed by the <code>astrobee.ndc.nasa.gov server</code>. This server is currently on the ARC TI private network. It is <em>critical</em> to be able to reach this server to install the pre-built custom debian. If none of the solutions below allow you to reach <code>astrobee.ndc.nasa.gov</code>, you can use the instructions on how to build the Debian dependencies manually following the INSTALL.md instructions (Dependencies section).</p>
<h4><a class="anchor" id="autotoc_md118"></a>
If on the ARC TI private network</h4>
<p>This is the typical case for all wired computers in ARC TI, and simplifies your life greatly.</p>
<p>Verify that you are in this situation with the command below should succeed (remove the Release.gpg file after being fetched). </p><pre class="fragment">wget -v http://astrobee.ndc.nasa.gov/software/dists/xenial/Release.gpg
</pre><p> Before running the scripts in <code>scripts/setup</code> below, set this variable: </p><pre class="fragment">export NO_TUNNEL=1
</pre> <h4><a class="anchor" id="autotoc_md119"></a>
If not on the ARC TI private network</h4>
<p>If you are outside the NASA ARC private network, there are two options to reach <code>astrobee.ndc.nasa.gov</code>:</p>
<ol type="1">
<li>Use VPN to act like if you were inside the ARC TI private network and obtain the correct kerberos credentials inside the VM with the following command (note the capitalization): <div class="fragment"><div class="line">kinit $NDC_USERNAME@NDC.NASA.GOV`</div>
</div><!-- fragment --></li>
<li>setup your <code>.ssh/config</code> to do ssh forwarding. A tutorial on this method is available at: <a href="https://babelfish.arc.nasa.gov/trac/freeflyer/wiki/SSHSetup">https://babelfish.arc.nasa.gov/trac/freeflyer/wiki/SSHSetup</a></li>
</ol>
<p>For either solution, please verify that you can SSH to <code>m.ndc.nasa.gov</code> without entering your password (<code>m</code> is used to tunnel to <code>astrobee.ndc.nasa.gov</code>):</p>
<p>ssh $NDC_USERNAME@m.ndc.nasa.gov</p>
<p>The command should succeed without entering your password. Once this is verified, exit this session on <code>m</code> with &lt;ctrl&gt;+D.</p>
<ul>
<li>These notes apply to <code>install_desktop_16.04_packages.sh</code> and <code>make_xenial.sh</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md120"></a>
Checkout the project source code</h3>
<p>At this point you need to decide where you'd like to put the source code (<code>SOURCE_PATH</code>) on your machine: </p><pre class="fragment">export SOURCE_PATH=$HOME/astrobee
</pre><p> First, clone the flight software repository: </p><pre class="fragment">git clone https://github.com/nasa/astrobee.git --branch develop $SOURCE_PATH
git submodule update --init --depth 1 description/media
</pre><p> You can either choose which optional submodules to clone and log depth with: </p><pre class="fragment">git submodule update --init --depth 1 submodules/android
git submodule update --init --depth 1 submodules/avionics
git submodule update --init --depth 1 submodules/platform
</pre><p> Or checkout all the submodules as: </p><pre class="fragment">git submodule update --init --depth 1
</pre><p> (Note: re-enter your username and password for every submodule that is cloned) The android module is necessary for guest science code; the avionics and platform module is used when cross-compiling to test on the robot hardware.</p>
<h3><a class="anchor" id="autotoc_md121"></a>
Dependencies</h3>
<p>Next, install all required dependencies: </p><pre class="fragment">pushd $SOURCE_PATH
cd scripts/setup
./add_local_repository.sh
./add_ros_repository.sh
./install_desktop_16_04_packages.sh
popd
</pre> <h4><a class="anchor" id="autotoc_md122"></a>
Extra options to install the dependencies</h4>
<ul>
<li>If you do not want to configure your <code>.ssh/config</code> to just get the dependencies, you can use the <code>NDC_USERNAME</code> variable.</li>
<li>By default, the custom debians are installed in <code>$SOURCE_PATH/.astrobee_deb</code>. If you prefer to install them at a different location, you can use the <code>ARS_DEB_DIR</code> variable.</li>
</ul>
<div class="fragment"><div class="line">export NDC_USERNAME=jdoe</div>
<div class="line">export ARS_DEB_DIR=$HOME/astrobee_debs</div>
<div class="line">./add_local_repository.sh</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md123"></a>
Cross-compile setup</h3>
<p>If you are planning to compile code to run on the robot hardware, you will need to install a cross-compile chroot and toolchain. Select two directories for these: </p><pre class="fragment">export ARMHF_CHROOT_DIR=$HOME/arm_cross/rootfs
export ARMHF_TOOLCHAIN=$HOME/arm_cross/toolchain/gcc
</pre><p> Append these lines to your .bashrc file, as you will need these two variables every time you cross compile.</p>
<p>Next, download the cross toolchain and install the chroot: </p><pre class="fragment">mkdir -p $ARMHF_TOOLCHAIN
cd $HOME/arm_cross
$SOURCE_PATH/submodules/platform/fetch_toolchain.sh
$SOURCE_PATH/submodules/platform/rootfs/make_xenial.sh dev $ARMHF_CHROOT_DIR
</pre> <h2><a class="anchor" id="autotoc_md124"></a>
Configuring the build</h2>
<p>At this point you need to decide whether you'd like to compile natively [<code>native</code>] (run code against a simulator) or for an ARM target [<code>armhf</code>] (run the code on the robot itself). Please skip to the relevant subsection.</p>
<h3><a class="anchor" id="autotoc_md125"></a>
Note for both builds setup</h3>
<p>By default, the configure script uses the following paths:</p>
<ul>
<li>native build path (BUILD_PATH): <code>$HOME/astrobee_build/native</code></li>
<li>native install path (INSTALL_PATH): <code>$HOME/astrobee_install/native</code></li>
<li>armhf build path (BUILD_PATH): <code>$HOME/astrobee_build/armhf</code></li>
<li>armhf install path (INSTALL_PATH): <code>$HOME/astrobee_install/armhf</code></li>
</ul>
<p>You should set these values in your shell.</p>
<p>If you are satisfied with these paths, you can invoke the <code>configure.sh</code> without the <code>-p</code> and <code>-b</code> options. For the simplicity of the instructions below, we assume that <code>$BUILD_PATH</code> and <code>$INSTALL_PATH</code> contain the location of the build and install path for either <code>native</code> or <code>armhf</code> platforms.</p>
<h3><a class="anchor" id="autotoc_md126"></a>
Native build</h3>
<p>The configure script prepares your build directory for compiling the code. Note that <code>configure.sh</code> is simply a wrapper around CMake that provides an easy way of turning on and off options. To see which options are supported, simply run <code>configure.sh -h</code>. </p><pre class="fragment">pushd $SOURCE_PATH
./scripts/configure.sh -l
popd
</pre><p> If you want to explicitly specify the build and install directories, use instead: </p><pre class="fragment">./scripts/configure.sh -l -p $INSTALL_PATH -b $BUILD_PATH
</pre> <h3><a class="anchor" id="autotoc_md127"></a>
Cross-compile build</h3>
<p>Cross compiling for the robot follows the same process, except the configure script takes a <code>-a</code> flag instead of <code>-l</code>. </p><pre class="fragment">pushd $SOURCE_PATH
./scripts/configure.sh -a
popd
</pre><p> Or with explicit build and install paths: </p><pre class="fragment">./scripts/configure.sh -a -p $INSTALL_PATH -b $BUILD_PATH
</pre><p> <em>Warning: <code>$INSTALL_PATH</code> and <code>$BUILD_PATH</code> used for cross compiling HAVE to be different than the paths for native build! See above for the default values for these.</em></p>
<h2><a class="anchor" id="autotoc_md128"></a>
Building the code</h2>
<p>To build, run <code>make</code> in the <code>$BUILD_PATH</code>. Note that depending on your host machine, this might take in the order of tens of minutes to complete the first time round. Future builds will be faster, as only changes to the code are rebuilt, and not the entire code base. </p><pre class="fragment">pushd $BUILD_PATH
make -j6
popd
</pre><p> <em>Note: <code>$BUILD_PATH</code> above is either the path for native build or armhf build, whatever you currently are doing.</em></p>
<h2><a class="anchor" id="autotoc_md129"></a>
Running a simulation</h2>
<p>In order to run a simulation you must have build natively. You will need to first setup your environment, so that ROS knows about the new packages provided by Astrobee flight software: </p><pre class="fragment">pushd $BUILD_PATH
source devel/setup.bash
popd
</pre><p> After this command has completed, you should be able to run a simulator from any directory in your Linux filesystem. So, for example, to start a simulation of a single Astrobee in the Granite Lab, run the following: </p><pre class="fragment">roslaunch astrobee sim.launch
</pre><p> This command tells ROS to look for the <code>sim.launch</code> file provided by the <code>astrobee</code> package, and use roslaunch to run it. Internally, ROS maintains a cache of information about package locations, libraries and executables. If you find that the above command doesn't work, try rebuilding the cache: </p><pre class="fragment">rospack profile
</pre><p> A simulator readme was created for guest science users. However this readme may be beneficial to interns and/or new members. If you fall into one of these categories, please see the <a class="el" href="sim__overview_8md.html">simulation instructions</a>.</p>
<h2><a class="anchor" id="autotoc_md130"></a>
Running the code on a real robot</h2>
<p>In order to do this, you will need to have followed the cross-compile build instructions. Once the code has been built, you also need to install the code to a singular location. CMake remembers what <code>$INSTALL_PATH</code> you specified, and will copy all products into this directory. </p><pre class="fragment">pushd $BUILD_PATH
make install
popd
</pre><p> Once the installation has completed, copy the install directory to the robot. This script assumes that you are connected to the Astrobee network, as it uses rsync to copy the install directory to <code>~/armhf</code> on the two processors. It takes the robot name as an argument. Here we use &lsquo;p4d&rsquo;. </p><pre class="fragment">pushd $SOURCE_PATH
./scripts/install_to_astrobee.sh $INSTALL_PATH p4d
popd
</pre><p> Here, p4d is the name of the robot, which may be different in your case.</p>
<p>You are now ready to run the code. This code launches a visualization tool, which starts the flight software as a background process. </p><pre class="fragment">pushd $SOURCE_PATH
python ./tools/gnc_visualizer/scripts/visualizer --proto4
popd
</pre> <h1><a class="anchor" id="autotoc_md131"></a>
Further information</h1>
<p>Please refer to the <a href="https://github.com/nasa/astrobee/wiki">wiki</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
</body>
</html>
