<!-- HTML header for doxygen 1.9.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NASA Astrobee Robot Software: EKF Bag</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.png" type="image/png" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="freeflyer.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td id="projectlogo"><img alt="Logo" src="astrobee-logo.png" height="100"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NASA Astrobee Robot Software
   &#160;<span id="projectnumber">0.12.0</span>
   </div>
   <div id="projectbrief">Flight software for the Astrobee robot operating inside the International Space Station.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ekfbag.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EKF Bag </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This package provides scripts used to evaluate the EKF and localization on recorded bag files. To record the bags, use the command </p><pre class="fragment">rosbag record /hw/cam_nav /hw/imu /loc/truth
</pre><p>The bag files should begin with at least 5 seconds of the robot remaining stationary so that we can estimate the imu bias.</p>
<h1><a class="anchor" id="autotoc_md390"></a>
ekf_graph</h1>
<p>Run <code>ekf_graph bag.bag</code> to create a pdf showing the results of the EKF on the recorded bag.</p>
<h1><a class="anchor" id="autotoc_md391"></a>
rosbag_to_csv</h1>
<p>Run <code>rosbag_to_csv bag.bag</code> to create a CSV file detailing the results of a run, which can then be passed to the GNC Matlab code for testing.</p>
<h1><a class="anchor" id="autotoc_md392"></a>
sparse_map_eval</h1>
<p>This tool evaluates how well a robot localizes images from a bag against a sparse map.</p>
<p>To use, first copy the desired robot's config file to the current directory, for example, as:</p>
<p>cp ~/astrobee/astrobee/config/robots/bumble.config robot.config</p>
<p>Then run the tool as:</p>
<p>python ~/astrobee/tools/ekf_bag/scripts/sparse_map_eval mybag.bag mymap.map</p>
<p>It will print on output some text like:</p>
<p>Localized 70 / 71 images with mean of 33 features.=====================] 100% Time per Frame: 0.32161 s CPU Time per Frame: 0.27612 s Run time: 23.9871</p>
<p>If, before launching this tool one runs:</p>
<p>export SAVE_FAILED_IMAGES_DIR=failed_images mkdir -p $SAVE_FAILED_IMAGES_DIR</p>
<p>it will save the images for which localization failed (with the image timestamp as image name) in the specified directory.</p>
<h1><a class="anchor" id="autotoc_md393"></a>
ekf_diff</h1>
<p>This is a tool for regression testing localization. It plots the difference between the ekf output of two sets of data generated from a single bag file, and has several features defined as flags. To run, first generate text files containing EKF output using ekf_graph. Then, run ekf_diff:: 'rosrun <a class="el" href="namespaceekf__bag.html">ekf_bag</a> ekf_diff bag1.txt bag2.txt' The flags are defined as follows: -s: define start time -e: define end time -p: define a minimum time difference between poses to compare, rather than all of them -i: resample data to match the first .txt file rather than selecting the neares timestamped data -r: use relative poses; at each measurement, report the difference between the current measurement and the last one rather than absolute positions on the global map -m: generate a heatmap of where in the ISS localization is less accurate -sm: use the sparse mapping poses from the first text file supplied as ground truth This tool relies on scipy 1.2.0: to upgrade this, run: 'python -m pip install scipy==1.2'</p>
<h1><a class="anchor" id="autotoc_md394"></a>
streamlit webserver</h1>
<p>This is a webserver to run some of the <a class="el" href="namespaceekf__bag.html">ekf_bag</a> scripts and automatically cache results. The server requires python &gt;= 3.6 (which will not be already installed from ROS) and the streamlit package installed using pip. After installing python3.6, run 'python3.6 -m pip install streamlit'. If this command fails, upgrade pip and retry. Additionally, install pdf2image by running: 'python3.6 -m pip install pdf2image'. Create a folder to store all data in. Then, inside that folder, create folders named "bags" and "maps". Put any map files in the "maps" folder, and any bag files in the "bags" folder. The "bags" folder also must contain a configuration file named robot.config (can be copied from astrobee/astrobee/config directory). Then, from the first folder you created, run: 'streamlit run /path/to/streamlit_server.py'</p>
<h1><a class="anchor" id="autotoc_md395"></a>
parameter_sweep.py</h1>
<p>This tool runs ekf_graph tests for a set of parameter combinations. Parameter ranges and names are defined in parameter_sweep.py and a gnc.config file is created for each parameter combination in the sweep. Each parameter combination is tested in parallel and results are saved locally to a timestamped directory or user defined directory.</p>
<h1><a class="anchor" id="autotoc_md396"></a>
create_plots.py</h1>
<p>Uses output of parameter_sweep.py and generates plots comparing the results of the sweep.</p>
<h1><a class="anchor" id="autotoc_md397"></a>
bag_sweep.py</h1>
<p>Runs ekf tests using a given gnc config file on a set of bag files in parallel.</p>
<h1><a class="anchor" id="autotoc_md398"></a>
bag_and_parameter_sweep.py</h1>
<p>Calls parameter_sweep on a set of bag files. <br  />
</p>
<h1><a class="anchor" id="autotoc_md399"></a>
create_average_plots.py</h1>
<p>Averages results for each job_id run over multiple tests and creates plots. Used for plotting bag_sweep.py results. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.0-->
<!-- start footer part -->
</body>
</html>
